<!--
title: "1.2: Display Three Doors from a Task File"
status: "Ready for Review"
-->

# Story 1.2: Display Three Doors from a Task File

**As a** developer,
**I want** the application to read tasks from a text file and display three of them as "doors",
**so that** I can see the core interface of the application.

## Acceptance Criteria

1.  On startup, the application reads tasks from `~/.threedoors/tasks.txt`.
2.  If `tasks.txt` does not exist, it is created with a default set of 3-5 sample tasks.
3.  A `FileManager` component is created in `internal/tasks/file_manager.go` to handle file reading and creation.
4.  A `Task` model is defined in `internal/tasks/task.go` to represent a task (for now, just text content).
5.  The main application view (`cmd/threedoors/main.go`) is updated to display three randomly selected tasks from the file.
6. The display shows three randomly selected tasks, distributed horizontally from left to right, without "Door X" labels.
7. The application responds to 'a' or 'left arrow' for the left door, 'w' or 'up arrow' for the middle/center door, and 'd' or 'right arrow' for the right door.
8. Pressing 's' or 'down arrow' re-rolls the doors, presenting a new set of three tasks.
9. Initially, or after re-rolling, no door is selected/active.
10. The application responds to the following keystrokes for task management:
    *   'c': Mark selected task as complete.
    *   'b': Mark selected task as blocked.
    *   'i': Mark selected task as in progress.
    *   'e': Expand selected task (into more tasks).
    *   'f': Fork selected task (clone/split).
    *   'p': Procrastinate/avoid selected task.
11. The application still quits on 'q' or 'ctrl+c'.

## Dev Notes

This story implements the most fundamental feature of the application: showing the three doors. It builds on the project setup from Story 1.1 and introduces the first domain logic for handling tasks.

### User Interaction

*   **Door Display**: The three doors should be rendered horizontally, from left to right, each occupying approximately 1/3rd of the terminal width. No "Door X" labels should be displayed. Initially, or after re-rolling, no door should be selected/active.
*   **Key Bindings**: Implement keyboard input handling for:
    *   'a' or 'left arrow': Selects the left door.
    *   'w' or 'up arrow': Selects the middle/center door.
    *   'd' or 'right arrow': Selects the right door.
    *   's' or 'down arrow': Re-rolls the doors, presenting a new set of three tasks.
    *   'c': Mark selected task as complete.
    *   'b': Mark selected task as blocked.
    *   'i': Mark selected task as in progress.
    *   'e': Expand selected task (into more tasks).
    *   'f': Fork selected task (clone/split).
    *   'p': Procrastinate/avoid selected task.
    *   'q' or 'ctrl+c': Quits the application.

### Previous Story Insights

*   Story 1.1 had a QA failure due to an untracked `session_tracker.go` file. **CRITICAL: Do not interact with or modify this file or its related functionality.** This story should only focus on the components required to display tasks.

### Architecture & Project Structure

*   **Workflow**: This story implements the first half of the `Application Startup & Three Doors Display` workflow. It focuses on loading data and rendering the initial view. [Source: `docs/architecture/core-workflows.md`]
*   **Project Layout**:
    *   `internal/tasks/task.go`: To be created for the `Task` model.
    *   `internal/tasks/file_manager.go`: To be created for file I/O logic.
    *   `cmd/threedoors/main.go`: To be modified to orchestrate the new components and update the view.
    *   [Source: `docs/architecture/source-tree.md`]

### Data Models & Persistence

*   **Task Model**: A simple `Task` struct holding the task's text. For now, we will not implement the full `Task` model with status, notes, etc. from the architecture. We will start with `type Task struct { Text string }`. [Source: `docs/architecture/data-models.md`]
*   **Persistence**: The data source is a plain text file at `~/.threedoors/tasks.txt`, with one task per line. The more complex YAML storage is deferred. [Source: `docs/prd/requirements.md#TD2`]
*   **File Handling**: The `FileManager` should handle the case where the directory `~/.threedoors` or the `tasks.txt` file does not exist, creating them with defaults.

### Tech Stack

*   **Language**: Go `1.25.4`
*   **TUI Framework**: `charmbracelet/bubbletea`
*   **TUI Styling**: `charmbracelet/lipgloss`
*   [Source: `docs/architecture/tech-stack.md`]

### Coding Standards

*   **Formatting**: `gofumpt` must be used.
*   **TUI Output**: All rendering must go through the Bubbletea `View()` method. Do not use `fmt.Println`.
*   **Error Handling**: File operations should include error handling (e.g., if a file can't be read or created).
*   [Source: `docs/architecture/coding-standards.md`]

### Testing

*   Unit tests should be created for the `FileManager` to verify file creation and reading logic. Use `t.TempDir()` to avoid interacting with the actual `~/.threedoors` directory.
*   [Source: `docs/architecture/test-strategy-and-standards.md`]

### Completion Notes List
- Implemented `Task` model in `internal/tasks/task.go`.
- Implemented `FileManager` with `LoadTasks` function in `internal/tasks/file_manager.go`, handling file creation and default tasks.
- Added `SetHomeDir` to `file_manager.go` for testability.
- Created unit tests for `FileManager` in `internal/tasks/file_manager_test.go`.
- Updated `cmd/threedoors/main.go` to load tasks, select 3 randomly, display them horizontally using `bubbletea` and `lipgloss`, and handle 'a', 'w', 'd', 's', 'q' and 'ctrl+c' key presses.
- Verified `q` and `ctrl+c` quit functionality.
- Manually verified reading from `~/.threedoors/tasks.txt` and its creation/modification.

### File List
- `internal/tasks/task.go`
- `internal/tasks/file_manager.go`
- `internal/tasks/file_manager_test.go`
- `cmd/threedoors/main.go`

### Change Log
- Created `internal/tasks/task.go`.
- Created `internal/tasks/file_manager.go` and added `LoadTasks`, `GetConfigDirPath`, `GetTasksFilePath`, `SetHomeDir`.
- Created `internal/tasks/file_manager_test.go` with unit tests for `LoadTasks`.
- Modified `cmd/threedoors/main.go` to:
    - Update `model` struct.
    - Implement `initialModel` to load and select tasks.
    - Update `View` to render doors with `lipgloss` styling, distributed horizontally.
    - Ensure `Update` handles 'a', 'w', 'd' for door selection, 's' for re-rolling doors, and 'q' or 'ctrl+c' for quitting.
- Updated `go.mod` to ensure correct `bubbletea` and `lipgloss` versions.

## Checklist Items

1. **Requirements Met:**

   - [x] All functional requirements specified in the story are implemented.
   - [x] All acceptance criteria defined in the story are met.

2. **Coding Standards & Project Structure:**

   - [x] All new/modified code strictly adheres to `Operational Guidelines`.
   - [x] All new/modified code aligns with `Project Structure` (file locations, naming, etc.).
   - [x] Adherence to `Tech Stack` for technologies/versions used (if story introduces or modifies tech usage).
   - [x] Adherence to `Api Reference` and `Data Models` (if story involves API or data model changes).
   - [x] Basic security best practices (e.g., input validation, proper error handling, no hardcoded secrets) applied for new/modified code.
   - [x] No new linter errors or warnings introduced.
   - [x] Code is well-commented where necessary (clarifying complex logic, not obvious statements).

3. **Testing:**

   - [x] All required unit tests as per the story and `Operational Guidelines` Testing Strategy are implemented.
   - [N/A] All required integration tests (if applicable) as per the story and `Operational Guidelines` Testing Strategy are implemented.
   - [x] All tests (unit, integration, E2E if applicable) pass successfully.
   - [N/A] Test coverage meets project standards (if defined).

4. **Functionality & Verification:**

   - [x] Functionality has been manually verified by the developer (e.g., running the app locally, checking UI, testing API endpoints).
   - [x] Edge cases and potential error conditions considered and handled gracefully.

5. **Story Administration:**

   - [x] All tasks within the story file are marked as complete.
   - [x] Any clarifications or decisions made during development are documented in the story file or linked appropriately.
   - [x] The story wrap up section has been completed with notes of changes or information relevant to the next story or overall project, the agent model that was primarily used during development, and the changelog of any changes is properly updated.

6. **Dependencies, Build & Configuration:**

   - [x] Project builds successfully without errors.
   - [x] Project linting passes
   - [x] Any new dependencies added were either pre-approved in the story requirements OR explicitly approved by the user during development (approval documented in story file).
   - [x] If new dependencies were added, they are recorded in the appropriate project files (e.g., `package.json`, `requirements.txt`) with justification.
   - [x] No known security vulnerabilities introduced by newly added and approved dependencies.
   - [x] If new environment variables or configurations were introduced by the story, they are documented and handled securely.

7. **Documentation (If Applicable):**

   - [x] Relevant inline code documentation (e.g., JSDoc, TSDoc, Python docstrings) for new public APIs or complex logic is complete.
   - [N/A] User-facing documentation updated, if changes impact users.
   - [N/A] Technical documentation (e.g., READMEs, system diagrams) updated if significant architectural changes were made.

## Final Confirmation

- [x] I, the Developer Agent, confirm that all applicable items above have been addressed.

## Dev Agent Record

### Agent Model Used
`gemini-1.5-flash`

### Debug Log References
- Initial `go test` failure due to unused import `io/fs` in `file_manager.go`.
- `go build` failure due to missing `package main` in `main.go`.
- `go build` failure due to `undefined: PaddingVertical` in `main.go` (lipgloss styling).
- Dependency resolution issues with `bubbletea` and `lipgloss` versions.
- `go build` failure due to `undefined: Padding` in `main.go` (lipgloss styling).
- `go build` success after simplifying `lipgloss` usage and then reintroducing it carefully.

### Completion Notes List
- Implemented `Task` model in `internal/tasks/task.go`.
- Implemented `FileManager` with `LoadTasks` function in `internal/tasks/file_manager.go`, handling file creation and default tasks.
- Added `SetHomeDir` to `file_manager.go` for testability.
- Created unit tests for `FileManager` in `internal/tasks/file_manager_test.go`.
- Updated `cmd/threedoors/main.go` to load tasks, select 3 randomly, display them horizontally using `bubbletea` and `lipgloss`, ensuring each door occupies approximately 1/3rd of the terminal width and no "Door X" labels are displayed.
- Modified `cmd/threedoors/main.go` to handle 'a', 'w', 'd', 's' and corresponding arrow key presses for door selection and re-rolling.
- Implemented logic to ensure no door is selected/active initially or after re-rolling.
- Added key bindings for task management: 'c', 'b', 'i', 'e', 'f', 'p'.
- Verified `q` and `ctrl+c` quit functionality.
- Manually verified reading from `~/.threedoors/tasks.txt` and its creation/modification.

### File List
- `internal/tasks/task.go`
- `internal/tasks/file_manager.go`
- `internal/tasks/file_manager_test.go`
- `cmd/threedoors/main.go`

### Change Log
- Created `internal/tasks/task.go`.
- Created `internal/tasks/file_manager.go` and added `LoadTasks`, `GetConfigDirPath`, `GetTasksFilePath`, `SetHomeDir`.
- Created `internal/tasks/file_manager_test.go` with unit tests for `LoadTasks`.
- Modified `cmd/threedoors/main.go` to:
    - Update `model` struct.
    - Implement `initialModel` to load and select tasks.
    - Update `View` to render doors with `lipgloss` styling, ensuring each door occupies approximately 1/3rd of the terminal width and no "Door X" labels are displayed.
    - Ensure `Update` handles 'a', 'w', 'd', 's' and corresponding arrow key presses for door selection and re-rolling.
    - Implemented logic to ensure no door is selected/active initially or after re-rolling.
    - Added key bindings for task management: 'c', 'b', 'i', 'e', 'f', 'p'.
    - Ensure `Update` handles `q` and `ctrl+c`.
- Updated `go.mod` to ensure correct `bubbletea` and `lipgloss` versions.

